"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{9144:function(e,t,s){var l=s(5893),a=s(1608),r=s(6154),o=s(7294),n=s(4981),i=s(243),d=s(9431),c=s(1955),x=s(7632);let u=e=>{let t=new Date(e);return(t.getHours()>12?t.getHours()-12:t.getHours())+":"+t.getMinutes()+" "+(t.getHours()>=12?"PM":"AM")},m=()=>{let e=new Date;return e.toISOString()},p=(e,t)=>{var s=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16);return t?"rgba("+s+", "+l+", "+a+", "+t+")":"rgb("+s+", "+l+", "+a+")"},h=e=>{var t,s;let{username:h,onClose:g,onLoad:f}=e,v=a.w.apiUrl,b=(0,o.useRef)(null),[j,w]=(0,o.useState)(!1),[N,y]=(0,o.useState)(""),[k,S]=(0,o.useState)(null),[I,C]=(0,o.useState)(!0),[q,E]=(0,o.useState)(""),[P,_]=(0,o.useState)(null),[H,T]=(0,o.useState)([]),z=(null==P?void 0:P.theme)?P.theme:"#05b6d3",M=(null==P?void 0:P.theme)?p(P.theme,.3):p("#05b6d3",.3);(0,o.useEffect)(()=>{if(!h)return;let e=async()=>{let e=await r.Z.get("".concat(v,"/api/v1/prompt/").concat(h)),t=e.data;_({id:t.id,userId:t.userId,username:t.username,avatar:t.avatar,logo:t.logo,theme:t.theme,prompt:t.prompt,quickPrompt:t.quickPrompt,location:t.location,credits:t.credits}),C(!1)};e()},[h]),(0,o.useEffect)(()=>{if(P&&!1===I){var e;let t=null==P?void 0:null===(e=P.quickPrompt)||void 0===e?void 0:e.initialMessage;if(0===H.length){let e=m(),s=u(e);t?T(l=>[...l,{sender:"bot",text:t,date:e,time:s}]):T(t=>[...t,{sender:"bot",text:"Hello, How can you assist you today?",date:e,time:s}]);let l=c.Z.get("visitorId");l||(l=(0,x.Z)(),c.Z.set("visitorId",l,{expires:365})),y(l),Z(null==P?void 0:P.id,l,H,k,e,s),f&&f({...P,themeColor:z,themeColorOpacity:M})}}},[null==P?void 0:P.quickPrompt,I]);let Z=async(e,t,s,l,a,o)=>{try{let n=r.Z.post("".concat(v,"/api/v1/chatbot/conversation/save"),{chatbotId:e,visitorId:t,conversation:s,conversationId:l,date:a,time:o});n.then(e=>{e.data.conversationId&&S(e.data.conversationId)})}catch(e){console.error("Error saving conversation:",e)}},D=async e=>{if(e)try{await r.Z.put("".concat(v,"/api/v1/credits/deduct"),{userId:e})}catch(e){console.log(e),console.error("Error updating user credits:",e)}},L=async e=>{if(!P)return;let t=m(),s=u(t),l=[...H,{sender:"user",text:e,date:t,time:s}];T(l),w(!0),D(P.userId);try{let t=await fetch("".concat(v,"/api/v1/chatbot/conversation/chat/").concat(P.id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,history:H,username:P})});if(t.body){let e=t.body.getReader(),s=new TextDecoder("utf-8"),l="",a="";for(;;){let t=await e.read(),{done:r,value:o}=t;if(r){let e=m(),t=u(e);T(s=>{let a=[...s,{sender:"bot",text:l,date:e,time:t}];return Z(P.id,N,a,k,e,t),localStorage.setItem("conversation",JSON.stringify(a)),a}),E(""),w(!1);break}a+=s.decode(o,{stream:!0});let n=a.split("\n");a=n.pop()||"",n.filter(e=>e.startsWith("data: ")).map(e=>e.replace(/^data: /,"").trim()).filter(e=>""!==e&&"[DONE]"!==e).forEach(e=>{l+=e+" ",E(l)})}}}catch(e){console.error("Error:",e)}},O=()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})};return((0,o.useEffect)(()=>{O()},[H,q]),I)?(0,l.jsx)("div",{children:"Loading..."}):(0,l.jsxs)("div",{className:"my-0 flex h-full max-h-screen w-full max-w-2xl flex-col rounded-lg border-[1px] sm:mx-auto sm:my-10 sm:h-[93%] ",children:[(0,l.jsxs)("div",{className:"flex w-full items-center gap-[8px] rounded-t-lg border-b-[1px] px-[16px] py-[16px] text-xl",children:[(0,l.jsx)("img",{src:(null==P?void 0:P.logo)||"/images/user.jpg",alt:"Chatbot logo",className:"h-10 w-10 rounded-full"}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-md text-sm font-semibold leading-4",children:[h," "]}),(null==P?void 0:P.location)?(0,l.jsxs)("div",{className:"flex items-center gap-[1px]",children:[(0,l.jsx)(n,{className:"h-4 w-4 text-zinc-500"})," ",(0,l.jsx)("p",{className:"status text-sm text-zinc-400",children:P.location})]}):null]}),g?(0,l.jsx)("button",{onClick:g,type:"button",className:"ml-auto",children:(0,l.jsx)(i,{className:"h-7 w-7",style:{color:z}})}):null]}),(0,l.jsxs)("div",{className:"h-full flex-grow space-y-[12px] overflow-y-auto px-[18px] py-[24px] pb-[0px]",children:[H.map((e,t)=>(0,l.jsx)("div",{children:"bot"===e.sender?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-end",children:[(0,l.jsx)("img",{src:(null==P?void 0:P.avatar)||"/images/user.jpg",alt:"Chatbot avatar",className:"h-8 w-8 rounded-full"}),(0,l.jsx)("div",{className:"ml-[7px] max-w-[74%] rounded-[16px] rounded-bl-none border-[1px] bg-white p-[12px]",children:(0,l.jsx)("p",{className:"break-words text-sm font-light leading-5 text-black",dangerouslySetInnerHTML:{__html:e.text}})})]}),(0,l.jsxs)("div",{className:"flex items-end",children:[(0,l.jsx)("div",{className:"w-8"}),(0,l.jsx)("p",{className:"ml-[7px] mt-1 text-xs font-light text-zinc-400",children:e.time})]})]}):(0,l.jsx)("div",{className:"flex items-end",children:(0,l.jsxs)("div",{className:"ml-auto w-fit max-w-[74%]",children:[(0,l.jsx)("div",{className:"rounded-[16px] rounded-bl-none border-[1px] p-[12px]",style:{backgroundColor:M},children:(0,l.jsx)("p",{className:"break-words text-sm font-light leading-5 text-black",dangerouslySetInnerHTML:{__html:e.text}})}),(0,l.jsx)("p",{className:"mt-1 text-right text-xs font-light text-zinc-400",children:e.time})]})})},t)),j?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"flex items-end",children:[(0,l.jsx)("img",{src:(null==P?void 0:P.logo)||"/images/user.jpg",alt:"Chatbot logo",className:"h-8 w-8 rounded-full"}),q?(0,l.jsx)("div",{className:"ml-[7px] max-w-[74%] rounded-[16px] rounded-bl-none border-[1px] bg-white p-[12px]",children:(0,l.jsx)("p",{className:"break-words text-sm font-light leading-5 text-black",dangerouslySetInnerHTML:{__html:q}})}):(0,l.jsx)("div",{className:"ml-[7px] max-w-[74%] rounded-[16px] rounded-bl-none border-[1px] bg-white px-[12px]",children:(0,l.jsx)("p",{className:"break-words text-sm font-light leading-5 text-black",children:(0,l.jsx)("img",{src:"/dots-loading.gif",alt:"Loading...",className:"h-8 w-8"})})})]})}):null,(0,l.jsx)("div",{ref:b})]}),(0,l.jsxs)("div",{className:"mt-[4px] p-[12px] pt-[0px]",children:[(null==P?void 0:null===(t=P.quickPrompt)||void 0===t?void 0:null===(s=t.quickPrompts)||void 0===s?void 0:s.length)?(0,l.jsx)("div",{className:"mb-1 flex flex-wrap items-start justify-end gap-1",children:P.quickPrompt.quickPrompts.map((e,t)=>(0,l.jsx)("button",{className:"m-0 rounded-md border-[1px] bg-white px-[8px] py-[1px] text-sm font-light hover:bg-zinc-100",style:{borderColor:z,color:z},onClick:()=>L(e),children:e},"prompt-message-".concat(t)))}):null,(0,l.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,l.jsxs)("form",{onSubmit:e=>{if(!j){e.preventDefault();let t=e.currentTarget.elements[0];(null==t?void 0:t.value)&&(L(t.value),t.value="")}},className:"relative flex w-full",children:[(0,l.jsx)("input",{className:"w-full flex-grow rounded-[16px] border-[1px] p-[12px] pr-16 text-sm focus:border-zinc-300 focus:outline-none",type:"text",multiple:!0,placeholder:"Type message...",required:!0,autoFocus:!0}),(0,l.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 transform",children:(0,l.jsx)("button",{className:"ml-3 flex h-9 w-9 items-center justify-center rounded-full text-white hover:bg-zinc-100",style:{backgroundColor:j?"#bcbdbf":z},disabled:j,type:"submit",children:(0,l.jsx)(d,{className:"h-6 w-6 rounded-full"})})})]})})]})]})};t.Z=h}}]);